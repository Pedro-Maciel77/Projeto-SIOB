<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painel Bombeiros — Relatórios</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/theme.css">
  <style>
    .app{display:flex;gap:28px}
    .main{flex:1;padding:36px}
    h1{margin:6px 0 26px 0;font-size:22px}
    .top-cards{display:flex;gap:18px;margin-bottom:18px}
    .card{padding:18px;border-radius:12px;flex:0 0 140px}
    .card small{display:block;color:var(--muted);font-size:12px}
    .card .num{font-weight:700;font-size:18px;margin-top:10px}
    .filters{display:flex;gap:12px;margin:18px 0 24px;flex-wrap:wrap}
    .filter{background:var(--panel-2);padding:12px;border-radius:12px;color:#bfbfbf;min-width:160px}
    .filter label{display:block;font-size:12px;color:#9b9b9b;margin-bottom:6px;font-weight:600}
    .filter select, .filter input[type="date"]{background:transparent;border:0;color:#cfcfcf;padding:6px;font-size:0.9rem;outline:none;width:100%}
    .filter .date-range{display:flex;gap:6px;align-items:center}
    .filter .date-range input{flex:1}
    .filter .sep{color:#666}
    .charts{display:flex;gap:18px}
    .panel{padding:18px;border-radius:12px;flex:1;min-height:240px}
    .legend{display:flex;gap:12px;align-items:center;margin-top:14px}
    .legend .item{display:flex;align-items:center;gap:8px}
    .dot{width:12px;height:12px;border-radius:50%}
    .table-wrap{background:linear-gradient(180deg,#1f1d1f,#161516);padding:18px;border-radius:12px;margin-top:24px}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="logo-sm">
        <img src="img/image.png" alt="logo" />
        <strong>Painel Bombeiros</strong>
      </div>

      <nav class="menu">
        <a href="Ocorrencias.html"><span class="icon"></span> Ocorrências</a>
        <a href="Relatorios.html"><span class="icon"></span> Relatórios</a>
        <a href="Usuarios.html"><span class="icon"></span> Usuários</a>
        <a href="Auditoria.html"><span class="icon"></span> Auditoria</a>
      </nav>
    </aside>

    <main class="main">
      <div class="topbar"><a href="Perfil.html" class="user-btn"><div class="avatar-sm">C</div><div>Cauã Nunes</div></a></div>
      <h1>Relatório</h1>

      <div class="top-cards">
        <div class="card"><small>Total Ocorrências</small><div class="num" id="totalOcorrencias">0</div></div>
        <div class="card"><small>Finalizados</small><div class="num" id="totalFinalizados">0</div></div>
        <div class="card"><small>Abertos</small><div class="num" id="totalAbertos">0</div></div>
        <div class="card"><small>Em Andamento</small><div class="num" id="totalAndamento">0</div></div>
      </div>

      <div class="filters">
        <div class="filter">
          <label>Periodo</label>
          <div class="date-range">
            <input type="date" id="periodoStart">
            <span class="sep">a</span>
            <input type="date" id="periodoEnd">
          </div>
        </div>
        
        <div class="filter">
          <label>Tipo</label>
          <select id="tipoFilter">
            <option value="">Todos</option>
            <option value="incendio">Incêndio</option>
            <option value="resgate">Resgate</option>
            <option value="acidente">Acidente</option>
          </select>
        </div>
        
        <div class="filter">
          <label>Regiões</label>
          <select id="regiaoFilter">
            <option value="">Todas</option>
            <option value="Dois Unidos">Dois Unidos</option>
            <option value="Afogados">Afogados</option>
            <option value="Alto Bondade">Alto Bondade</option>
            <option value="Joao de Barros">Joao de Barros</option>
          </select>
        </div>
        
        <div class="filter">
          <label>Status</label>
          <select id="statusFilter">
            <option value="">Todos</option>
            <option value="aberta">Aberta</option>
            <option value="fechada">Fechada</option>
            <option value="em andamento">Em Andamento</option>
          </select>
        </div>
      </div>

      <div class="mt-12">
        <button class="btn" id="btnGerarRelatorio">Gerar Relatório</button>
        <button class="btn-alt" id="btnLimparFiltros">Limpar Filtros</button>
      </div>

      <div class="table-wrap" id="relatorioTable" style="display:none">
        <h3 style="margin-bottom:16px">Resultados do Relatório</h3>
        <table>
          <thead>
            <tr><th>ID</th><th>TIPO</th><th>DATA</th><th>LOCAL</th><th>STATUS</th></tr>
          </thead>
          <tbody id="relatorioBody">
          </tbody>
        </table>
      </div>

      <div class="charts">
        <div class="panel">
          <h3>Ocorrências por Tipo</h3>
          <svg width="220" height="160" viewBox="0 0 220 160" class="center-svg">
            <circle cx="110" cy="80" r="50" fill="#222" />
            <circle cx="110" cy="80" r="50" fill="none" stroke="#2ecc71" stroke-width="30" stroke-dasharray="78 78 78 78" stroke-dashoffset="0" transform="rotate(-90 110 80)" />
          </svg>
          <div class="legend">
            <div class="item"><span class="dot dot-outros"></span> Outros <span id="countOutros">0</span></div>
            <div class="item"><span class="dot dot-incendio"></span> Incêndios <span id="countIncendios">0</span></div>
            <div class="item"><span class="dot dot-resgate"></span> Resgate <span id="countResgates">0</span></div>
            <div class="item"><span class="dot dot-acidentes"></span> Acidentes <span id="countAcidentes">0</span></div>
          </div>
        </div>

        <div class="panel">
          <h3>Status das Ocorrências</h3>
          <div class="chart-placeholder">
            <div class="chart-dot"></div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>

    (function(){
      const links = document.querySelectorAll('.menu a');
      const path = location.pathname.split('/').pop();
      links.forEach(a=>{ 
        a.classList.remove('selected'); 
        if(a.getAttribute('href')===path) a.classList.add('selected');
      });
    })();

    // Dados de exemplo de ocorrências
    const ocorrencias = [
      {id: 0, tipo: 'incendio', data: '21/10/2025', local: 'Dois Unidos', status: 'Aberta'},
      {id: 1, tipo: 'resgate', data: '08/12/2025', local: 'Afogados', status: 'Fechada'},
      {id: 2, tipo: 'resgate', data: '12/06/2023', local: 'Alto Bondade', status: 'Fechada'},
      {id: 3, tipo: 'acidente', data: '21/10/2025', local: 'Dois Unidos', status: 'Aberta'},
      {id: 4, tipo: 'acidente', data: '21/10/2025', local: 'Joao de Barros', status: 'Aberta'},
      {id: 5, tipo: 'incendio', data: '15/09/2025', local: 'Afogados', status: 'Em Andamento'},
      {id: 6, tipo: 'resgate', data: '03/11/2025', local: 'Alto Bondade', status: 'Em Andamento'},
      {id: 7, tipo: 'incendio', data: '28/08/2025', local: 'Dois Unidos', status: 'Fechada'}
    ];

    function parseDateDDMMYYYY(str) {
      if(!str) return null;
      const parts = str.split('/');
      if(parts.length !== 3) return null;
      const d = parseInt(parts[0], 10);
      const m = parseInt(parts[1], 10) - 1;
      const y = parseInt(parts[2], 10);
      return new Date(y, m, d);
    }

    function gerarRelatorio() {
      const periodoStart = document.getElementById('periodoStart').value;
      const periodoEnd = document.getElementById('periodoEnd').value;
      const tipo = document.getElementById('tipoFilter').value.toLowerCase();
      const regiao = document.getElementById('regiaoFilter').value;
      const status = document.getElementById('statusFilter').value.toLowerCase();

      const startDate = periodoStart ? new Date(periodoStart) : null;
      const endDate = periodoEnd ? new Date(periodoEnd) : null;

    
      const filtradas = ocorrencias.filter(occ => {
        let match = true;

       
        if(tipo && occ.tipo.toLowerCase() !== tipo) match = false;

        
        if(regiao && occ.local !== regiao) match = false;

        
        if(status && occ.status.toLowerCase() !== status) match = false;

     
        const occDate = parseDateDDMMYYYY(occ.data);
        if(startDate && occDate && occDate < startDate) match = false;
        if(endDate && occDate && occDate > endDate) match = false;

        return match;
      });

 
      document.getElementById('totalOcorrencias').textContent = filtradas.length;
      
      const fechadas = filtradas.filter(o => o.status.toLowerCase() === 'fechada').length;
      const abertas = filtradas.filter(o => o.status.toLowerCase() === 'aberta').length;
      const andamento = filtradas.filter(o => o.status.toLowerCase() === 'em andamento').length;
      
      document.getElementById('totalFinalizados').textContent = fechadas;
      document.getElementById('totalAbertos').textContent = abertas;
      document.getElementById('totalAndamento').textContent = andamento;

      
      const incendios = filtradas.filter(o => o.tipo === 'incendio').length;
      const resgates = filtradas.filter(o => o.tipo === 'resgate').length;
      const acidentes = filtradas.filter(o => o.tipo === 'acidente').length;
      const outros = filtradas.length - (incendios + resgates + acidentes);

      document.getElementById('countIncendios').textContent = incendios;
      document.getElementById('countResgates').textContent = resgates;
      document.getElementById('countAcidentes').textContent = acidentes;
      document.getElementById('countOutros').textContent = outros;

   
      const tbody = document.getElementById('relatorioBody');
      tbody.innerHTML = '';
      
      if(filtradas.length > 0) {
        filtradas.forEach(occ => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${occ.id}</td>
            <td>${occ.tipo}</td>
            <td>${occ.data}</td>
            <td>${occ.local}</td>
            <td><span class="status">${occ.status}</span></td>
          `;
          tbody.appendChild(row);
        });
        document.getElementById('relatorioTable').style.display = 'block';
      } else {
        document.getElementById('relatorioTable').style.display = 'none';
        alert('Nenhuma ocorrência encontrada com os filtros selecionados.');
      }
    }

    function limparFiltros() {
      document.getElementById('periodoStart').value = '';
      document.getElementById('periodoEnd').value = '';
      document.getElementById('tipoFilter').value = '';
      document.getElementById('regiaoFilter').value = '';
      document.getElementById('statusFilter').value = '';
      
      document.getElementById('totalOcorrencias').textContent = '0';
      document.getElementById('totalFinalizados').textContent = '0';
      document.getElementById('totalAbertos').textContent = '0';
      document.getElementById('totalAndamento').textContent = '0';
      document.getElementById('countIncendios').textContent = '0';
      document.getElementById('countResgates').textContent = '0';
      document.getElementById('countAcidentes').textContent = '0';
      document.getElementById('countOutros').textContent = '0';
      
      document.getElementById('relatorioTable').style.display = 'none';
    }

    
    document.getElementById('btnGerarRelatorio').addEventListener('click', gerarRelatorio);
    document.getElementById('btnLimparFiltros').addEventListener('click', limparFiltros);

   
    window.addEventListener('load', () => {
      gerarRelatorio();
    });
  </script>
</body>
</html>
